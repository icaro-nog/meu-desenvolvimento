var CustomizeBuilder_V1;!function(r){var l=r(document),c=wp.customize||null,W=Customify_Layout_Builder.is_rtl;CustomizeBuilder_V1=function(a,s){var e={id:s,controlId:"",cols:12,cellHeight:45,items:[],container:null,ready:!1,devices:{desktop:"Desktop",mobile:"Mobile/Tablet"},activePanel:"desktop",panels:{},activeRow:"main",draggingItem:null,getTemplate:_.memoize(function(){var o=this,n={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g,variable:"data"};return function(e,t,i){return _.isUndefined(t)&&(t="tmpl-customize-control-"+o.type),!_.isUndefined(i)&&_.isString(i)?n.variable=i:n.variable="data",_.template(r("#"+t).html(),null,n)(e)}}),drag_drop:function(){var a=this;r(".customify--device-panel",a.container).each(function(){var i=r(this),o=i.data("device"),n=[],e=(a.panels[o]={},r(".customify--cb-items",i).each(function(e){var t=r(this).attr("data-id")||"",t=t?"_sid_"+o+"-"+t:"_sid_"+o+e;r(this).attr("id",t),n[e]="#"+t}),r(".grid-stack",i).each(function(){var e=r(this).attr("data-id")||"";a.panels[o][e]=r(this),r(this).droppable({out:function(e,t){},over:function(e,t){},drop:function(e,t){var i=r(this);a.gridster(i,t,e),a.save()}})}),r("#_sid_mobile-sidebar",i)),t=e.attr("id")||!1;r(".customify-available-items .grid-stack-item",i).draggable({revert:"invalid",connectToSortable:!!t&&"#"+t,start:function(e,t){r("body").addClass("builder-item-moving"),r(".customify--cb-items",i).css("z-index",""),t.helper.parent().css("z-index",9999)},stop:function(e,t){r("body").removeClass("builder-item-moving"),r(".customify--cb-items",i).css("z-index",""),t.helper.parent().css("z-index","")}}),0<e.length&&(e.sortable({revert:!0,change:function(e,t){a.save()},receive:function(e,t){r(this).find(".grid-stack-item").removeAttr("style").attr("data-gs-width",1),a.save()}}),a.panels[o].sidebar=e),r(".customify-available-items .grid-stack-item",i).resizable({handles:"w, e",stop:function(e,t){a.setGridWidth(t.element.parent(),t),a.save()}})})},sortGrid:function(e){r(".grid-stack-item",e).each(function(){var e,t=r(this),i=t.attr("data-gs-x")||0,i=parseInt(i),o=t.next();0<o.length&&(e=o.attr("data-gs-x")||0,(e=parseInt(e))<i&&t.insertAfter(o))})},getX:function(e){e=e.attr("data-gs-x")||0;return parseInt(e)},getW:function(e,t){t=(t=_.isUndefined(t)?!1:t)?e.attr("data-df-width")||1:e.attr("data-gs-width")||1;return parseInt(t)},gridGetItemInfo:function(e,t,i){for(var o=this.getX(e),n=this.getW(e),a=0,s=0,r=!1,l=o-1;0<=l&&!r;)0===t[l]?a++:r=!0,l--;for(r=!1,l=o+n;l<this.cols&&!r;)0===t[l]?s++:r=!0,l++;return{flag:t,x:o,w:n,item:e,before:a,after:s,id:e.attr("data-id")||"",wrapper:i}},updateItemsPositions:function(e){for(var t=this.cols,i=0;i<=t;i++)"object"!=typeof e[i]&&"function"!=typeof e[i]||e[i].attr("data-gs-x",i)},gridster:function(e,t,i){var o,n,x=[],b=this,y=this.cols,I=function(e){for(var t=e.x,i=e.w,o=e.el,n=t;n<t+i;n++)x[n]=n===t?o:1},s=function(e){for(var t=e.x,i=e.w,o=(e.el,t);o<t+i;o++)x[o]=0},z=function(){for(var e=0,t=0;t<y;t++)0===x[t]&&e++;return e},C=function(e,t){for(var i=0,o=e;o<y;o++)if(0===x[o])i++;else if(t)return i;return i},P=function(e,t){var i=0;void 0===t&&(t=!1);for(var o=e;0<=o;o--)if(0===x[o])i++;else if(t)return i;return i},D=function(e){return 0===x[e]},k=function(e,t){for(var i=e;i<e+t;){if(0!==x[i])return!1;i++}return!0},A=function(e){if(e<0)return{x:-1,w:1};var t,i,o,n=-1;if(x[e]<=1)for(t=e,o=!1;0<=t&&!o;)1!==x[t]&&0!==x[t]&&(n=t,o=!0),t--;else n=e;for(t=n+1,i=n;1===x[t];)i++,t++;return{x:n,w:i+1-n}},S=function(e){var t,i,o,n=-1;if(x[e]<y)for(t=e,o=!1;t<y&&!o;)1!==x[t]&&0!==x[t]&&(n=t,o=!0),t++;else n=e;for(t=n+1,i=n;1===x[t];)i++,t++;return{x:n,w:i+1-n}},T=function(e,t){var i=x.slice(),o=P(e);if(0===o)return t;for(var n=A(e),a=0<=n.x?n.x+n.w-1:e,s=t,s=o<t?o:t,r=0,l=0,c=a;l<=s&&0<=c;)0===x[c]&&(l++,r=c),c--;for(var d=[],f=0,c=r;c<=a;c++)(x[c]=0)!==i[c]&&(d[f]=i[c],f++);for(f=0,c=r;c<=a;c++)void 0!==d[f]?x[c]=d[f]:x[c]=0,f++;return t-s},M=function(e,t){var i=x.slice(),o=C(e);if(0===o)return t;for(var n=A(e),a=0<=n.x?n.x:e,s=t,s=t<=o?t:o,r=e,l=0,c=a;l<s&&c<y;)0===x[c]&&(l++,r=c),c++;for(var d=[],f=0,c=a;c<=r;c++)(x[c]=0)!==i[c]&&(d[f]=i[c],f++);for(f=d.length-1,c=r;a<=c;c--)void 0!==d[f]?x[c]=d[f]:x[c]=0,f--;return t-s},G=function(){b.updateItemsPositions(x)},r=function(e,t){var i,o,n=e.x,a=e.w,s=z();if(s<=0)return!1;if(!(t=_.isUndefined(t)?!1:t)){if(D(n)){if(k(n,o=a))return I(e),e.el.attr("data-gs-x",n),e.el.attr("data-gs-width",o),!0;for((i=a<=(u=C(n,!0))+(t=P(n-1,!0))&&a-u<=t?n-(a-u):n-t)<0&&(i=0),console.log("_re",u),console.log("_le",t),console.log("__x",i);1<=o;){if(k(i,o))return console.log({x:i,w:o}),e.x=i,e.w=o,I(e),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",o),!0;o--}}if(1===x[n]){t=A(n);if(0<=t.x&&n>t.x+Math.floor(t.w/2)&&n>t.x&&(i=t.x+t.w,u=C(i,!0),console.log("__re",u),console.log("__re_X",i),a<=u))return I({el:e.el,x:i,w:a}),e.el.attr("data-gs-x",i),e.el.attr("data-gs-width",a),!0}}console.log("--------------------------------------------------------");var r,l,c=e,d=_.clone(n),t=0,f=!1;if(console.log("insert at x",d),console.log("insert node",c),D(d)){if(console.log("empty_at_X",d),r=A(d),u=S(d),-1<r.x){if(console.log("found_item_left",r),(t=C(r.x))>=c.w)if(k(d,c.w))console.log("found",c),n=d,f=!0;else if(c.ox>d)for(l=r.x+r.w,m=(m=P(l))<=c.w?c.w-m:c.w,M(l+1,m),t=C(l),console.log("loop_start_i",l),f=!1;l>r.x+r.w&&!f;)k(l,c.w)&&(console.log("found_in_loop__i",l),n=l,f=!0),l--;if(!f&&c.ox<d){console.log("try_move_items_to_left",r),l=r.x+r.w-1,m=P(r.x),console.log("el",m),m>c.w&&(m=c.w),T(r.x,m-=2),console.log("try_move_items_to_left_flag",x),console.log("el2",m),l-=t=C(l);var u=S(d),g=r.x+r.w;for(-1<u.x&&(g=u.x),console.log("loop_start 2_i",l);l<g&&!f;)k(l,c.w)&&(console.log("found_in_loop__@__i",l),n=l,f=!0),l++}f||(n=r.x+r.w,c.w=t,c.x=n,console.log("resize_new_w",t),console.log("resize_new_x",n))}else if(-1<u.x){console.log("found_item_right",u),u=S(d),t=C(d,!1),console.log("move_all_item_to Right");var m=t>=c.w?c.w:t;for(M(d,m),l=u.x,console.log("loop_start Right",l);0<=l&&!f;)k(l,c.w)&&(n=l,c.x=n,f=!0,console.log("found_in_while_r",l)),l--;f||(n=d,c.w=t,c.x=n,console.log("resize_r_new_w",t),console.log("resize_r_new_x",n))}}else if(console.log("x is not empty"),r=A(d),c.ox<r.x)if(T(d,c.w),console.log("Move All items to left"),D(d))n=d;else{for(;!D(d)&&d<=b.cols-1;)d++;n=d}else if(M(d,c.w),console.log("Move All items to right"),D(d))n=d;else{for(;!D(d)&&0<=d;)d--;n=d}n>b.cols&&(n=b.cols-1),c.x=n,console.log("new node x",n);var v,p,h=!1,w=0;for(n+a>b.cols-1&&(w=P(n,!0),console.log("le",w),0<w&&console.log("move_Left",n+a-b.cols-1)),G(),w=0;1<=a;){if(a<=s){if(k(n,a))return console.log("",{x:n,w:a}),e.w=a,I(e),e.el.attr("data-gs-x",n),e.el.attr("data-gs-width",a),!0;for(w=P(n,!(h=!1)),v=n-w,console.log("newX",v),p=v;p<y&&!h;){if(k(p,a))return console.log("Insert in While",{x:p,w:a}),e.w=a,I({el:e.el,x:p,w:a}),e.el.attr("data-gs-x",p),e.el.attr("data-gs-width",a),h=!0;p++}}a--}for(a=e.w,h=!1;1<=a;){for(p=0;p<y&&!h;){if(k(p,a))return console.log("Insert in While 2",{x:p,w:a}),I({el:e.el,x:p,w:a}),e.el.attr("data-gs-x",p),e.el.attr("data-gs-width",a),h=!0;p++}a--}return console.log("Insert END While",{x:p,w:a}),!1},a=(x=(b=this).getFlag(e)).slice(),l=e.offset(),c=(b.draggingItem=t.draggable,e.width()),d=c/b.cols,f=0,u=t.offset,g=b.getW(t.draggable,!1),m=b.getW(t.draggable,!0),v=t.draggable.width(),p=(console.log("DROP ITEM WIDTH",m),console.log("DROP ITEM cw WIDTH",g),b.getX(t.draggable)),h=(W&&s({el:t.draggable,x:p,w:m}),0),w=0,R=!1;if(t.draggable.parent().is(e)?(o=!0,console.log("Item in this row"),m=g):(o=!1,console.log("Not in this row"),m<g&&(m=g)),W?(h=Math.round((l.left+c+10-i.clientX)/d),(w=Math.round((l.left+c-(u.left+v+10))/d))<0&&(w=0)):(h=Math.round((i.clientX-l.left)/d),(w=Math.round((u.left-l.left-10)/d))<0&&(w=0)),h>b.cols&&(h=b.cols),n=f=w,W)if(D(n))f=w,R=!0;else for(;n<b.cols&&!R;)D(n)?R=!0:n++;else if(D(f))f=w,R=!0;else{for(;f<=h&&!R;)D(f)?R=!0:f++;h<f&&(f=h)}if((f=(f=R?f:o?w:h)<0?0:f)+m>=b.cols){for(R=!0,n=f;n+m>b.cols&&R;)D(n)?n--:(n++,R=!1),console.log("loop_i",n);console.log("Find new _i, w: "+m,n),f=n}delete R,console.log("DROP Cursor",h),console.log("DROP row x cacl",f),console.log("DROP item w",m);c={el:t.draggable,x:f,w:m,ox:p,ow:g},c.x<=0&&(c.x=0),v=!1;o?(c.x=parseInt(t.draggable.attr("data-gs-x")||0),c.w=parseInt(t.draggable.attr("data-gs-width")||1),console.log("swap node",c),function(e,t){e.x;var i=e.w,o=(s(e),console.log("Swap newX",t),console.log("Before Swap FLAG",x),A(t)),n=0;if(-1<o.x&&(n=o.x+o.w),k(t,i))return I({el:e.el,x:t,w:i});if(0<n&&k(n,i)&&n<=t){o=S(t);if(-1<o.x&&e.w+t>=o.x)for(var a=_.clone(t);n<a;){if(k(a,i))return I({el:e.el,x:a,w:i});a--}if(t+i>b.cols){o=b.cols-i;if(k(o,i))return I({el:e.el,x:o,w:i})}return I({el:e.el,x:n,w:i})}e.x=t,r(e,!0)}(c,f),v=!0):(v=r(c),console.log("Insert node")),v?(t.draggable.removeClass("item-from-list"),e.append(t.draggable),t.draggable.removeAttr("style"),console.log("DID Flag: ",x),b.draggingItem=null):(t.draggable.removeAttr("style"),console.log("Can not insert"),x=a),G(),b.updateAllGrids()},updateAllGrids:function(){var i=this;_.each(i.panels[i.activePanel],function(e,t){i.updateGridFlag(e)})},setGridWidth:function(e,t){var i,o,n,a,s=this,r=t.element,l=e.width(),c=t.size.width,d=t.originalSize.width,l=Math.ceil(l/s.cols)-1,d=W?(v=t.originalPosition.left>t.position.left,d!==c):(v=t.originalPosition.left>t.position.left,t.originalPosition.left<t.position.left),f=t.originalElement.attr("data-gs-width")||1,u=t.originalElement.attr("data-gs-x")||0,f=parseInt(f),u=parseInt(u),g=s.getFlag(e),g=s.gridGetItemInfo(t.originalElement,g,e);if(v)return W?(o=Math.floor((t.position.left-1)/l),n=f+(i=(i=(o=s.cols-o)-u-f)>g.after?g.after:i),r.attr("data-gs-x",u).removeAttr("style")):(n=f+(i=(i=u-(o=Math.floor((t.position.left-1)/l)))>g.before?g.before:i),r.attr("data-gs-x",o=u-i).removeAttr("style")),r.attr("data-gs-width",n).removeAttr("style"),void s.updateGridFlag(e);if(d)return W?(t.originalPosition.left!==t.position.left?(o=Math.floor((t.position.left-1)/l),n=f-(i=f<(i=f+u-(o=s.cols-o))?0:i),(o=u)<=0&&(o=0),console.log("diffRight_RTL_COL_New __left")):(o=Math.ceil((t.position.left+t.size.width-11)/l),o=u-(i=(i=u-(o=s.cols-o))>g.before?g.before:i),n=f+i),r.attr("data-gs-x",o).removeAttr("style")):((n=f-(i=(o=Math.round((t.position.left-1)/l))-u))<=0&&(n=1,i=0),r.attr("data-gs-x",o=u+i).removeAttr("style")),r.attr("data-gs-width",n).removeAttr("style"),void s.updateGridFlag(e);var m,v=g.x;c<t.originalSize.width?(m=Math.round((t.position.left+t.size.width-11)/l),a=g.w-(v+g.w-(m=m<=v?v+1:m))):(m=Math.ceil((t.position.left+t.size.width-11)/l),a=g.w+(m-(v+g.w)),g.x+a>g.x+g.w+g.after&&(a=g.w+g.after)),r.attr("data-gs-width",a=a<=0?1:a).removeAttr("style"),s.updateGridFlag(e)},getFlag:function(e){var t,i=e.data("gridRowFlag")||[];if(_.isEmpty(i)){for(t=0;t<this.cols;t++)i[t]=0;e.data("gridRowFlag",i)}return i},updateGridFlag:function(e){for(var o=this,n=[],a=0;a<o.cols;a++)n[a]=0;return r(".grid-stack-item",e).each(function(e){r(this).removeAttr("style");var t=o.getX(r(this)),i=o.getW(r(this));for(a=t;a<t+i;a++)n[a]=a===t?r(this):1}),e.data("gridRowFlag",n),o.updateItemsPositions(n),o.sortGrid(e),n},addNewWidget:function(e,t){var i=this,o=i.container.find(".customify--device-panel.customify--panel-"+i.activePanel);_.isObject(t)||(t=o.find(".customify--cb-items").first());e.draggable({revert:"invalid",appendTo:o,scroll:!1,zIndex:99999,handle:".grid-stack-item-content",start:function(e,t){r("body").addClass("builder-item-moving"),r(".customify--cb-items",o).css("z-index",""),t.helper.parent().css("z-index",9999)},stop:function(e,t){r("body").removeClass("builder-item-moving"),r(".customify--cb-items",o).css("z-index",""),i.save()},drag:function(e,t){}}).resizable({handles:"w, e",start:function(e,t){t.originalElement.css({right:"auto",left:t.position.left})},stop:function(e,t){i.setGridWidth(t.element.parent(),t),i.save()}}),t.append(e),i.updateGridFlag(t)},addPanel:function(e){var t=this.getTemplate(),i="tmpl-customify--cb-panel";if(0!=r("#"+i).length)return _.isObject(a.rows)||(a.rows={}),'<div class="customify--device-panel customify-vertical-panel customify--panel-'+e+'" data-device="'+e+'">'+t({device:e,id:a.id,rows:a.rows},i)+"</div>"},addDevicePanels:function(){var o=this;_.each(o.devices,function(e,t){var i=o.addPanel(t);r(".customify--cb-devices-switcher",o.container).append('<a href="#" class="switch-to switch-to-'+t+'" data-device="'+t+'">'+e+"</a>"),r(".customify--cb-body",o.container).append(i)}),r("#customify-upsell-tmpl").length&&r(r("#customify-upsell-tmpl").html()).insertAfter(r(".customify--cb-devices-switcher",o.container))},addItem:function(e){var t=this.getTemplate(),i="tmpl-customify--cb-item";if(0!=r("#"+i).length)return t=t(e,i),r(t)},addAvailableItems:function(){var a=this;_.each(a.devices,function(e,o){var n=r('<div class="customify-available-items" data-device="'+o+'"></div>');r(".customify--panel-"+o,a.container).append(n),_.each(a.items,function(e){var t,i=!0;_.isUndefined(e.devices)||_.isEmpty(e.devices)||(_.isString(e.devices)?e.devices!=o&&(i=!1):(t=!1,_.each(e.devices,function(e){o==e&&(t=!0)}),t||(i=!1))),i&&(i=a.addItem(e),n.append(i))})})},switchToDevice:function(e,t){var i=this;1<_.size(i.devices)?(r(".customify--cb-devices-switcher a",i.container).removeClass("customify--tab-active"),r(".customify--cb-devices-switcher .switch-to-"+e,i.container).addClass("customify--tab-active"),r(".customify--device-panel",i.container).addClass("customify--panel-hide"),r(".customify--device-panel.customify--panel-"+e,i.container).removeClass("customify--panel-hide"),i.activePanel=e):r(".customify--cb-devices-switcher a",i.container).addClass("customify--tab-active"),(_.isUndefined(t)||t)&&r("desktop"==e?"#customize-footer-actions .preview-desktop":"#customize-footer-actions .preview-mobile").trigger("click")},addExistingRowsItems:function(){var s=this,t=c.control(s.controlId).params.value;_.isObject(t)||(t={}),_.each(s.panels,function(n,a){var e={};_.isObject(t[a])&&(e=t[a]),_.each(e,function(e,o){_.isUndefined(e)||_.each(e,function(e,t){var i=r('.customify-available-items[data-device="'+a+'"] .grid-stack-item[data-id="'+e.id+'"]').first();i.attr("data-gs-width",e.width),i.attr("data-gs-x",e.x),i.removeClass("item-from-list"),s.addNewWidget(i,n[o])})})}),s.ready=!0},focus:function(){this.container.on("click",".customify--cb-item-setting, .customify--cb-item-name, .item-tooltip",function(e){e.preventDefault();var e=r(this).data("section")||"",t=r(this).attr("data-control")||"",i=!1;t&&!_.isUndefined(c.control(t))&&(c.control(t).focus(),i=!0),i||e&&!_.isUndefined(c.section(e))&&c.section(e).focus()}),this.container.on("click",".customify--cb-row-settings",function(e){e.preventDefault();e=r(this).attr("data-id")||"",e=a.id+"_"+e;_.isUndefined(c.section(e))||c.section(e).focus()})},remove:function(){var i=this;l.on("click",".customify--device-panel .customify--cb-item-remove",function(e){e.preventDefault();var e=r(this).closest(".grid-stack-item"),t=e.closest(".customify--device-panel");e.attr("data-gs-width",1),e.attr("data-gs-x",0),e.removeAttr("style"),r(".customify-available-items",t).append(e),i.updateAllGrids(),i.save()})},encodeValue:function(e){return encodeURI(JSON.stringify(e))},decodeValue:function(e){return JSON.parse(decodeURI(e))},save:function(){var o,n=this;n.ready&&(o={},_.each(n.panels,function(e,i){o[i]={},_.each(e,function(e,t){e=_.map(r(" > .grid-stack-item",e),function(e){return e=r(e),{x:n.getX(e),y:1,width:n.getW(e),height:1,id:e.data("id")||""}});o[i][t]=e})}),c.control(n.controlId).setting.set(n.encodeValue(o)))},showPanel:function(){var t=this;this.container.removeClass("customify--builder--hide").addClass("customify--builder-show"),setTimeout(function(){var e=t.container.height();r("#customize-preview").addClass("cb--preview-panel-show").css({bottom:e-1,"margin-top":"0px"})},100)},hidePanel:function(){this.container.removeClass("customify--builder-show"),r("#customize-preview").removeClass("cb--preview-panel-show").removeAttr("style")},togglePanel:function(){var t=this;c.state("expandedPanel").bind(function(e){c.panel(a.panel).expanded()?(l.trigger("customify_panel_builder_open",[a.panel]),console.log("open-builder:",a.panel),top._current_builder_panel=s,t.showPanel()):t.hidePanel()}),t.container.on("click",".customify--panel-close",function(e){e.preventDefault(),t.container.toggleClass("customify--builder--hide"),t.container.hasClass("customify--builder--hide")?r("#customize-preview").removeClass("cb--preview-panel-show"):r("#customize-preview").addClass("cb--preview-panel-show")})},panelLayoutCSS:function(){var e=r("#customize-controls").width();c.state("paneVisible").get()||(e=0),W?this.container.find(".customify--cb-inner").css({"margin-right":e}):this.container.find(".customify--cb-inner").css({"margin-left":e})},init:function(e,t,i){var o=this,n=o.getTemplate()(a,"tmpl-customify--builder-panel");o.container=r(n),r("body .wp-full-overlay").append(o.container),o.controlId=e,o.items=t,o.devices=i,a.section&&c.section(a.section).container.addClass("customify--hide"),o.addDevicePanels(),o.switchToDevice(o.activePanel),o.addAvailableItems(),o.switchToDevice(o.activePanel),o.drag_drop(),o.focus(),o.remove(),o.addExistingRowsItems(),c.panel(a.panel).expanded()?(console.log("open-builder:",a.panel),o.showPanel()):o.hidePanel(),c.previewedDevice.bind(function(e){"desktop"===e?o.switchToDevice("desktop",!1):o.switchToDevice("mobile",!1)}),o.togglePanel(),c.state("paneVisible").get()&&o.panelLayoutCSS(),c.state("paneVisible").bind(function(){o.panelLayoutCSS()}),r(window).resize(_.throttle(function(){o.panelLayoutCSS()},100)),o.container.on("click",".customify--cb-devices-switcher a.switch-to",function(e){e.preventDefault();e=r(this).data("device");o.switchToDevice(e)}),l.trigger("customify_builder_panel_loaded",[s,o])}};return e.init(a.control_id,a.items,a.devices),e}}(jQuery);